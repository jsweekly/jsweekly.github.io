<!doctype html><div style="max-width: 700px;font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;padding: 50px;line-height: 1.25;background: #f9f9f9;"><meta charset="UTF8"/><title>FiltrES.js: A Simple, Safe, ElasticSearch Query Compiler</title><h1>FiltrES.js: A Simple, Safe, ElasticSearch Query Compiler</h1><p><a href="https://github.com/abeisgreat/FiltrES.js?">Original Article</a> &middot; <a href="#articleList">Articles in this issue</a> </p><div><article class="markdown-body entry-content">

<p><em>Pronounced like Fortress</em></p>

<p>A simple, safe, ElasticSearch query engine, allowing you or your end-users to enter arbitrary expressions without p0wning you or learning the ElasticSearch Query language.</p>

<div class="highlight highlight-python"><pre>(height <span class="pl-k">&lt;=</span> <span class="pl-c1">73</span> <span class="pl-k">or</span> (favorites.color <span class="pl-k">==</span> <span class="pl-s1"><span class="pl-pds">"</span>green<span class="pl-pds">"</span></span> <span class="pl-k">and</span> height <span class="pl-k">!=</span> <span class="pl-c1">73</span>)) <span class="pl-k">and</span> firstname <span class="pl-k">~</span><span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>o.+<span class="pl-pds">"</span></span></pre></div>

<h2>
<a id="user-content-why" class="anchor" href="https://github.com/abeisgreat/FiltrES.js#why"></a>Why?</h2>

<p>There are many cases where you want a user to be able enter an arbitrary expression through a user interface or simply want to avoid ElasticSearch's powerful, but complicated query language.</p>

<p>Sure, you could do that with ElasticSearch's "script" filter, but I'm sure I don't have to tell you how stupid that would be. It opens up many potential security issues.</p>

<p>FiltrES defines a really simple expression language that should be familiar to anyone who's ever used a spreadsheet and compile it into an ElasticSearch query at runtime.</p>

<h2>
<a id="user-content-features" class="anchor" href="https://github.com/abeisgreat/FiltrES.js#features"></a>Features</h2>

<ul class="task-list">
<li>  <strong>Simple!</strong> End user expression language looks like this <code>transactions &lt;= 5 and profit &gt; 20.5</code>
</li>
<li>  <strong>Fast!</strong> Expressions get compiled into native ElasticSearch queries, offering the same performance as if it had been hand coded. e.g. <code>{"filtered" : {"filter" : {"bool" : {"must" : {"term" : { "tag" : "wow" }}, "must_not" : {"range" : {"age" : { "from" : 10, "to" : 20 }}}</code>
</li>
<li>  <strong>Safe!</strong> Expressions cannot escape the sandbox client-side or inside of ElasticSearch.</li>
<li>  <strong>Predictable!</strong> Because users can't define loops or recursive functions, you know you won't be left hanging.</li>
</ul>

<h2>
<a id="user-content-get-it" class="anchor" href="https://github.com/abeisgreat/FiltrES.js#get-it"></a>Get it</h2>

<ul class="task-list">
<li>   <strong>DOWNLOAD <a href="https://rawgit.com/abeisgreat/filtres/master/filtres.js">filtres.js</a> or <a href="https://rawgit.com/abeisgreat/filtres/master/filtres.min.js">filtres.min.js</a></strong>
</li>
</ul>

<h2>
<a id="user-content-10-second-tutorial-using-elasticsearchclient" class="anchor" href="https://github.com/abeisgreat/FiltrES.js#10-second-tutorial-using-elasticsearchclient"></a>10 second tutorial (using <a href="https://github.com/phillro/node-elasticsearch-client">ElasticSearchClient</a>)</h2>

<div class="highlight highlight-javascript"><pre><span class="pl-c">// A search filter</span>
<span class="pl-s">var</span> expression <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">'</span>transactions &lt;= 5 and profit &gt; 20.5<span class="pl-pds">'</span></span>;

<span class="pl-c">// Compile expression to executable function</span>
<span class="pl-s">var</span> myQuery <span class="pl-k">=</span> filtres.<span class="pl-s3">compile</span>(expression);

<span class="pl-c">// Execute query</span>
esc.<span class="pl-s3">search</span>(<span class="pl-s1"><span class="pl-pds">"</span>filtres<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>accounts<span class="pl-pds">"</span></span>, myQuery, <span class="pl-st">function</span> (<span class="pl-vpf">err</span>, <span class="pl-vpf">accounts</span>) {
    ...
});</pre></div>

<h2>
<a id="user-content-expressions" class="anchor" href="https://github.com/abeisgreat/FiltrES.js#expressions"></a>Expressions</h2>

<p>There are only 2 types: numbers and strings. Numbers may be floating point or integers. Boolean logic is applied on the truthy value of values (e.g. any non-zero number is true, any non-empty string is true, otherwise false).</p>

<table>
<thead>
<tr>
<th>Values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>43, -1.234</td>
<td>Numbers</td>
</tr>
<tr>
<td>"hello"</td>
<td>String</td>
</tr>
<tr>
<td>foo, a.b.c</td>
<td>External data variable defined by application (may be numbers or strings)</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>Comparisons</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>x == y</td>
<td>Equals</td>
</tr>
<tr>
<td>x != y</td>
<td>Not equals</td>
</tr>
<tr>
<td>x ~= "y"</td>
<td>Matched to y evaluated as a RegExp</td>
</tr>
<tr>
<td>x ~!= "y"</td>
<td>Not matched to y evaluated as a RegExp</td>
</tr>
<tr>
<td>x &lt; y</td>
<td>Less than</td>
</tr>
<tr>
<td>x &lt;= y</td>
<td>Less than or equal to</td>
</tr>
<tr>
<td>x &gt; y</td>
<td>Greater than</td>
</tr>
<tr>
<td>x &gt;= y</td>
<td>Greater than or equal to</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
<th>Boolean logic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>x or y</td>
<td>Boolean or</td>
</tr>
<tr>
<td>x and y</td>
<td>Boolean and</td>
</tr>
<tr>
<td>not x</td>
<td>Boolean not</td>
</tr>
<tr>
<td>( x )</td>
<td>Explicity operator precedence</td>
</tr>
</tbody>
</table>

<p>Operator precedence follows that of any sane language.</p>

<h2>
<a id="user-content-faq" class="anchor" href="https://github.com/abeisgreat/FiltrES.js#faq"></a>FAQ</h2>

<p><strong>Why the name?</strong></p>

<p>Because it was originally built for FILTeR EXpressions then ported to ElasticSearch (i.e. ES).</p>

<p><strong>What's Jison?</strong></p>

<p><a href="http://zaach.github.io/jison/">Jison</a> is bundled with FiltrES - it's a JavaScript parser generator that does the underlying hard work of understanding the expression. It's based on Flex and Bison.</p>

<p><strong>License?</strong></p>

<p><a href="https://github.com/abeisgreat/filtres/raw/master/LICENSE">MIT</a></p>

<p><strong>Unit tests?</strong></p>

<p><a href="https://github.com/abeisgreat/filtres/blob/master/test/filtres-test.js">Here!</a></p>

<p><strong>What happens if the expression is malformed?</strong></p>

<p>Calling <code>filters.compile()</code> with a malformed expression will throw an exception. You can catch that and display feedback to the user. A good UI pattern is to attempt to compile on each keystroke and continuously indicate whether the expression is valid.</p>

<p>And <strong><a href="https://twitter.com/abeisgreat">follow @abeisgreat</a></strong> (<a href="https://github.com/abeisgreat/filtrES">FiltrES</a>) and <strong><a href="https://twitter.com/joewalnes">follow @joewalnes</a></strong> (<a href="https://github.com/joewalnes/filtrex">Filtrex</a>)!</p>
</article>
  </div><hr/><section id="articleList" style="font-size: 14px;"><b>Articles in This Issue</b><ul><li><a href="./Meta Programming with ECMAScript 6 Proxies.html">Meta Programming with ECMAScript 6 Proxies</a></li><li><a href="./AngularJS Performance in Large Applications.html">AngularJS Performance in Large Applications</a></li><li><a href="./What Is The Flux Application Architecture?.html">What Is The Flux Application Architecture?</a></li><li><a href="./An easier way to deploy &amp; host your Rails app – for free..html">An easier way to deploy &amp; host your Rails app – for free.</a></li><li><a href="./<img src="http:--s3.amazonaws.com-nlga-uploads-item-image-24793-i.png" style="border: 0px solid #bbbbbb" width="" height="" alt="Ninefold">.html"><img src="http://s3.amazonaws.com/nlga/uploads/item/image/24793/i.png" style="border: 0px solid #bbbbbb" width="" height="" alt="Ninefold"></a></li><li><a href="./16 Steps for Planning A Front-End JavaScript Application.html">16 Steps for Planning A Front-End JavaScript Application</a></li><li><a href="./Node.js Is Forked, Not F***ed.html">Node.js Is Forked, Not F***ed</a></li><li><a href="./Programmer Extraordinaire..html">Programmer Extraordinaire.</a></li><li><a href="./JavaScript Developers, AngularJS-Node.js (Berlin).html">JavaScript Developers, AngularJS/Node.js (Berlin)</a></li><li><a href="./President Obama Writes His First Line of JavaScript.html">President Obama Writes His First Line of JavaScript</a></li><li><a href="./ES6 Template Strings Working in Chrome.html">ES6 Template Strings Working in Chrome</a></li><li><a href="./Ember.js 1.9.0 and 1.10 Beta Released.html">Ember.js 1.9.0 and 1.10 Beta Released</a></li><li><a href="./'JavaScript for Kids' Book Released.html">'JavaScript for Kids' Book Released</a></li><li><a href="./Making A Complete Polyfill For The HTML5 'details' Element.html">Making A Complete Polyfill For The HTML5 'details' Element</a></li><li><a href="./Techniques for Building Web Apps using Future Friendly ES6 Module Syntax.html">Techniques for Building Web Apps using Future Friendly ES6 Module Syntax</a></li><li><a href="./Effective Event Binding with jQuery.html">Effective Event Binding with jQuery</a></li><li><a href="./Five Traits of Well-Organized JavaScript.html">Five Traits of Well-Organized JavaScript</a></li><li><a href="./Porting An Entire Desktop Toolchain to The Browser with Emscripten.html">Porting An Entire Desktop Toolchain to The Browser with Emscripten</a></li><li><a href="./The State of Desktop Applications in Node.js.html">The State of Desktop Applications in Node.js</a></li><li><a href="./thaw.js: Synthetic Asynchronous Processing.html">thaw.js: Synthetic Asynchronous Processing</a></li><li><a href="./FiltrES.js: A Simple, Safe, ElasticSearch Query Compiler.html">FiltrES.js: A Simple, Safe, ElasticSearch Query Compiler</a></li><li><a href="./Angular 2.0 Hello World Example.html">Angular 2.0 Hello World Example</a></li><li><a href="./Purplecoat.js: Simple Labeled Overlays (jQuery Plugin).html">Purplecoat.js: Simple Labeled Overlays (jQuery Plugin)</a></li><li><a href="./dstore: A Client-Side Data Management Framework with Multiple Store Types.html">dstore: A Client-Side Data Management Framework with Multiple Store Types</a></li><li><a href="./bigpicture.js: A Library for Prezi-esque Infinite Panning and Infinite Zooming.html">bigpicture.js: A Library for Prezi-esque Infinite Panning and Infinite Zooming</a></li><li><a href="./decimal.js: An Arbitrary-Precision Decimal Type for JavaScript.html">decimal.js: An Arbitrary-Precision Decimal Type for JavaScript</a></li></ul></section></div>