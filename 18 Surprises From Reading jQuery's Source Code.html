<!doctype html><div style="max-width: 700px;font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;padding: 50px;line-height: 1.25;background: #f9f9f9;"><meta charset="UTF8"/><title>18 Surprises From Reading jQuery's Source Code</title><h1>18 Surprises From Reading jQuery's Source Code</h1><p><a href="http://quickleft.com/blog/18-surprises-from-reading-jquery-s-source-code?">Original Article</a> &middot; <a href="#articleList">Articles in this issue</a> </p><div><div class="post_body"><p>I love jQuery, and though I consider myself an advanced JavaScript developer, I had never read the jQuery source from top to bottom, until now. Here are a few things that I learned along the way:</p>

<p><em>Note: I use the <code>$.fn.method()</code> syntax to refer to the practice of calling <code>method</code> on a set of matched elements. For example, when I say <code>$.fn.addClass</code>, that represents uses like <code>$(&#x2018;div&#x2019;).addClass(&#x2018;blue&#x2019;)</code> or <code>$(&#x2018;a.active&#x2019;).addClass(&#x2018;in-use&#x2019;)</code>. <code>$.fn</code> is the prototype for jQuery-wrapped elements.</em></p>

<ol>
<li><p><strong>Sizzle&#x2019;s weight:</strong> <a href="http://sizzlejs.com/">Sizzle</a> is the selector engine jQuery uses to find elements in a DOM based on CSS selectors. It&#x2019;s what turns <code>$(&#x2018;div.active&#x2019;)</code> into an array of elements you can operate on. I knew Sizzle made up a large portion of jQuery, but I was surprised at just how massive it really is. It&#x2019;s easily the single biggest feature, line-count wise, in jQuery source. By my calculations it makes up 22% of the overall codebase. That dwarfs the next biggest feature in jQuery&#x2014;<code>$.ajax</code>&#x2014;which makes up just 8% of the library&#x2019;s codebase.</p></li>
<li><p><strong>$.grep:</strong> <a href="http://api.jquery.com/jquery.grep/">This method</a> is similar to Underscore&#x2019;s <code>_.filter</code> in that it takes two arguments, an array of elements and a function, and returns the elements that pass the function&#x2019;s truth test. </p></li>
<li><p><strong>Bubbling caveats:</strong> jQuery specifically prohibits one type of event from ever bubbling. That is the <code>load</code> event. Internally, jQuery passes a special <code>noBubble: true</code> flag through with any <code>load</code> events, so that image.load events can&#x2019;t bubble up to the window (which could mistakenly match a window.load event). </p></li>
<li><p><strong>Default animation speed:</strong> jQuery animates elements by changing their style attributes in quick succession. Each of these changes is called a &#x201C;tick.&#x201D; The default animation speed is to run a tick every 13 milliseconds, and you can adjust this by overriding <code>jQuery.fx.interval</code> with your own integer. </p></li>
<li><p><strong>$.fn.addClass accepts a function:</strong> We usually supply <code>$.fn.addClass</code> with a string of class names to add to an element. But it can also accept a function. You must return a string of space-separated class names from this function to apply them to the matched element. As a bonus, this function receives the matched element&#x2019;s index as an argument, which you can use to build intelligent class names. </p></li>
<li><p><strong>So does $.fn.removeClass:</strong> This also accepts a function, like the method mentioned above. This function also automatically receives the element&#x2019;s index.</p></li>
<li><p><strong>:empty pseudo selector:</strong> This convenient pseudo selector will match elements with no children. </p></li>
<li><p><strong>:lt and :gt pseudo selectors:</strong> These pseudo selectors match elements based on their index in the matched set. For example, <code>$(&#x2018;div:gt(2)&#x2019;)</code> will return all divs except for the first three (numbers are zero-indexed). If you supply a negative integer as the argument, it counts backwards starting from the end of the set.</p></li>
<li><p><strong>$(document).ready() uses a promise:</strong> jQuery eats its own dog food, it would seem. Internally, trusty ol&#x2019; <code>$(document).ready()</code> uses a jQuery deferred to determine when the DOM is fully loaded.</p></li>
<li><p><strong>$.type:</strong> I&#x2019;m sure we&#x2019;re all familiar with <code>typeof</code> to determine what data type something is, but did you know jQuery provides a <code>.type()</code> method? jQuery&#x2019;s version is more intelligent than the native browser version. For example, <code>typeof (new Number(3))</code> returns &#x201C;object,&#x201D; whereas <code>$.type(new Number(3))</code> returns &#x201C;number.&#x201D; <em>Update: As ShirtlessKirk pointed out in the comments, $.type returns the type of the .valueOf() property of the receiving object. So it's more accurate to say that $.type tells you the type of the return value for an object.</em></p></li>
<li><p><strong>$.fn.queue:</strong> You can inspect an element&#x2019;s effects queue with the following example code: <code>$(&#x2018;div&#x2019;).queue()</code>. This is useful if you need to know how many effects are remaining on an element. Even more useful, you can directly manipulate the queue to add your own effects. From the jQuery docs:</p>
<div class="highlight"><pre><span class="nx">$</span><span class="p">(</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span> <span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<span class="nx">$</span><span class="p">(</span> <span class="s2">"div"</span> <span class="p">)</span>
  <span class="p">.</span><span class="nx">show</span><span class="p">(</span> <span class="s2">"slow"</span> <span class="p">)</span>
  <span class="p">.</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">left</span><span class="o">:</span> <span class="s2">"+=200"</span> <span class="p">},</span> <span class="mi">2000</span> <span class="p">)</span>
  <span class="p">.</span><span class="nx">queue</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">addClass</span><span class="p">(</span> <span class="s2">"newcolor"</span> <span class="p">).</span><span class="nx">dequeue</span><span class="p">();</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">animate</span><span class="p">({</span> <span class="nx">left</span><span class="o">:</span> <span class="s2">"-=200"</span> <span class="p">},</span> <span class="mi">500</span> <span class="p">)</span>
  <span class="p">.</span><span class="nx">queue</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s2">"newcolor"</span> <span class="p">).</span><span class="nx">dequeue</span><span class="p">();</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">slideUp</span><span class="p">();</span>
<span class="p">});</span>
</pre></div></li>
<li><p><strong>Click events prohibited on disabled elements:</strong> jQuery automatically won&#x2019;t process click events on disabled elements, a nice optimization to save you from having to write your code to check against this scenario. </p></li>
<li><p><strong>$.fn.on accepts an object:</strong> Did you know that <code>$.fn.on</code> accepts an object to attach multiple events at once? An example from the jQuery docs:</p>
<div class="highlight"><pre><span class="nx">$</span><span class="p">(</span> <span class="s2">"div.test"</span> <span class="p">).</span><span class="nx">on</span><span class="p">({</span>
<span class="nx">click</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">toggleClass</span><span class="p">(</span> <span class="s2">"active"</span> <span class="p">);</span>
<span class="p">},</span> <span class="nx">mouseenter</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">addClass</span><span class="p">(</span> <span class="s2">"inside"</span> <span class="p">);</span>
<span class="p">},</span> <span class="nx">mouseleave</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span> <span class="k">this</span> <span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s2">"inside"</span> <span class="p">);</span>
<span class="p">}</span>
<span class="p">});</span>
</pre></div></li>
<li><p><strong>$.camelCase:</strong> This utility method converts dashed-strings to camelCased strings. </p></li>
<li><p><strong>$.active:</strong> Calling <code>$.active</code> returns the number of active XHR queries. This can be useful for enforcing limits to how many in-flight AJAX requests you&#x2019;ll allow at once. </p></li>
<li><p><strong>$.fn.parentsUntil / $.fn.nextUntil / $.fn.prevUntil:</strong> I was very familiar with the <code>.parents()</code>, <code>.next()</code>, and <code>.prev()</code> methods, but I didn&#x2019;t know these other versions existed. Essentially, they&#x2019;ll match all parents/next elements/previous elements <em>until</em> they encounter your stop-condition element. </p></li>
<li><p><strong>$.fn.clone arguments:</strong> When you <code>.clone()</code> an element, you can also clone its data attributes and events by passing <code>true</code> as the first argument to <code>clone</code>.</p></li>
<li><p><strong>More $.fn.clone arguments:</strong> In addition to the above, you can clone its children&#x2019;s data attributes and events by passing an additional <code>true</code> argument. This is called a "deep clone." That second argument defaults to the value of the first (whose default is false). So if the first is <code>true</code> and you want the second to be <code>true</code>, you can omit the second argument entirely.</p></li>
</ol>

<p><em>An earlier version of this post said the return value of #5's function argument should be a comma-separated string. It should actually return a space-separated string. Thanks Jonathan!</em></p></div>
</div><hr/><section id="articleList" style="font-size: 14px;"><b>Articles in This Issue</b><ul><li><a href="./ECMAScript 6: New OOP Features Besides Classes.html">ECMAScript 6: New OOP Features Besides Classes</a></li><li><a href="./Generation JavaScript.html">Generation JavaScript</a></li><li><a href="./New Course on JS.Next: ES6.html">New Course on JS.Next: ES6</a></li><li><a href="./<img src="http:--s3.amazonaws.com-nlga-uploads-item-image-31237-125.png" style="border: 0px solid #bbbbbb" width="104" height="104" alt="Frontend Masters">.html"><img src="http://s3.amazonaws.com/nlga/uploads/item/image/31237/125.png" style="border: 0px solid #bbbbbb" width="104" height="104" alt="Frontend Masters"></a></li><li><a href="./Symbols in ECMAScript 6.html">Symbols in ECMAScript 6</a></li><li><a href="./'JavaScript for Kids' Book Released in Print.html">'JavaScript for Kids' Book Released in Print</a></li><li><a href="./JSConf US 2015 Announced.html">JSConf US 2015 Announced</a></li><li><a href="./JavaScript developers - spend 60 seconds applying to 50 NYC jobs at once.html">JavaScript developers - spend 60 seconds applying to 50 NYC jobs at once</a></li><li><a href="./underdog.io..html">underdog.io.</a></li><li><a href="./An Opinionated Rundown of JS Frameworks.html">An Opinionated Rundown of JS Frameworks</a></li><li><a href="./5 Array Methods That You Should Be Using Now.html">5 Array Methods That You Should Be Using Now</a></li><li><a href="./45 Useful JavaScript Tips, Tricks and Best Practices.html">45 Useful JavaScript Tips, Tricks and Best Practices</a></li><li><a href="./Learning Much JavaScript From One Line of Code.html">Learning Much JavaScript From One Line of Code</a></li><li><a href="./All About Angular 2.0.html">All About Angular 2.0</a></li><li><a href="./18 Surprises From Reading jQuery's Source Code.html">18 Surprises From Reading jQuery's Source Code</a></li><li><a href="./jQuery 1.11.2 and 2.1.3 Released (Safari Fail-Safe Edition).html">jQuery 1.11.2 and 2.1.3 Released (Safari Fail-Safe Edition)</a></li><li><a href="./npm's Year in Numbers: 2014.html">npm's Year in Numbers: 2014</a></li><li><a href="./Some Obscure JavaScript Pitfalls.html">Some Obscure JavaScript Pitfalls</a></li><li><a href="./Exploring Facebook Flow: Facebook's Type Checker for JavaScript.html">Exploring Facebook Flow: Facebook's Type Checker for JavaScript</a></li><li><a href="./Knowing Which Apps You’re Breaking using Static Analysis.html">Knowing Which Apps You’re Breaking using Static Analysis</a></li><li><a href="./6 Easy Ways to Prevent Your Heroku Node App From Sleeping.html">6 Easy Ways to Prevent Your Heroku Node App From Sleeping</a></li><li><a href="./Creating Objects without Prototypes.html">Creating Objects without Prototypes</a></li><li><a href="./Converting A Project From AMD to CommonJS with Recast.html">Converting A Project From AMD to CommonJS with Recast</a></li><li><a href="./intellij-es67: ES6-7 Syntax Improvements Plugin for Inteliij IDEA.html">intellij-es67: ES6/7 Syntax Improvements Plugin for Inteliij IDEA</a></li><li><a href="./PleaseWait.js: A Loading-Splash Screen for your SPA.html">PleaseWait.js: A Loading/Splash Screen for your SPA</a></li><li><a href="./React Templates: Lightweight Templates for React.html">React Templates: Lightweight Templates for React</a></li><li><a href="./angular-websocket: AngularJS 1.x WebSocket Service for Connecting Client Apps to Servers.html">angular-websocket: AngularJS 1.x WebSocket Service for Connecting Client Apps to Servers</a></li><li><a href="./jsrt: A Simple JavaScript Ray Tracing Engine.html">jsrt: A Simple JavaScript Ray Tracing Engine</a></li><li><a href="./Rome: A Customizable Date (and Time) Picker Control.html">Rome: A Customizable Date (and Time) Picker Control</a></li><li><a href="./Bitcore: A Powerful JavaScript Core for Bitcoin Projects.html">Bitcore: A Powerful JavaScript Core for Bitcoin Projects</a></li></ul></section></div>