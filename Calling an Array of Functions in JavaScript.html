<!doctype html><div style="max-width: 700px;font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;padding: 50px;line-height: 1.25;background: #f9f9f9;"><meta charset="UTF8"/><title>Calling an Array of Functions in JavaScript</title><h1>Calling an Array of Functions in JavaScript</h1><p><a href="http://zpao.com/posts/calling-an-array-of-functions-in-javascript/?">Original Article</a> &middot; <a href="#articleList">Articles in this issue</a> </p><div><div class="post-content">
          


<p>I&#x2019;ve reviewed some bits of code over the past couple months that stored functions in an array and then at some point in the future needed to call all of them. This is a very simple thing to do, but something about the code always bothered me.</p>

<p>Assuming:</p>
<div class="highlight"><pre><code class="language-js"><span class="kd">var</span> <span class="nx">callbacks</span> <span class="o">=</span> <span class="p">[</span>
  <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="p">},</span>
  <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> <span class="p">}</span>
<span class="p">];</span>
</code></pre></div>
<p>You end up iterating over the array and calling each function explicitly:</p>
<div class="highlight"><pre><code class="language-js"><span class="nx">callbacks</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">callback</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>
<p>Part of the beauty of <code class="prettyprint">forEach</code> is that you can pass it a function without it having to be defined each time. So we could define a function that does what our anonymous function does for us.</p>
<div class="highlight"><pre><code class="language-js"><span class="kd">function</span> <span class="nx">call</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">fn</span><span class="p">();</span>
<span class="p">}</span>
<span class="nx">callbacks</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">call</span><span class="p">);</span>
</code></pre></div>
<p>This works but it feels silly. JS already has <code class="prettyprint">Function.prototype.call</code> so why should we have to write our own. Let&#x2019;s figure out if we can make <code class="prettyprint">Function.prototype.call</code> work for us&#x2026;</p>

<h2>Function.prototype.call</h2>

<p>The very first thing to know about is some internal implementation details. Like most objects in JS, functions use prototypes, and so within the prototype <code class="prettyprint">this</code> refers to a particular instance. So a simplified implementation of <code class="prettyprint">call</code> would look something like this:</p>
<div class="highlight"><pre><code class="language-js"><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">call</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="p">...)</span> <span class="p">{</span>
  <span class="nx">CALL_FN_WITH_SCOPE</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">thisArg</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="p">...);</span>
<span class="p">}</span>
</code></pre></div>
<p>That&#x2019;s going to be down in native code and will of course vary by engine, but the important thing to remember is that <code class="prettyprint">this</code> is the function that gets called. There are a few more details in <a href="http://es5.github.io/#x15.3.4.4">the spec</a>.</p>

<p>The second thing to know is that you can call functions on prototypes, so long as you use them correctly. So let&#x2019;s try just calling one function.</p>
<div class="highlight"><pre><code class="language-js"><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">callbacks</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</code></pre></div>
<p>That&#x2019;s not going to work. Effectively you&#x2019;re just calling a function that then calls <code class="prettyprint">this</code>. We might be able to write some weird code that ends up doing what we want but let&#x2019;s not. What you actually want to do is call <code class="prettyprint">Function.prototype.call</code> with a specific <code class="prettyprint">this</code> so it knows what function to actually run. Confused?</p>
<div class="highlight"><pre><code class="language-js"><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">call</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">callbacks</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</code></pre></div>
<p>This works, but it&#x2019;s also equivalent to just saying <code class="prettyprint">callbacks[0].call()</code> so it&#x2019;s pretty bad form to do. But the point here is that we can now call a function by passing it as an argument instead of needing a proper handle to that function.</p>

<h2>Array.prototype.forEach</h2>

<p>The way <code class="prettyprint">forEach</code> works is also important to know. Go read <a href="http://es5.github.io/#x15.4.4.18">the spec</a>, or even just the <a href="https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/forEach">MDN page</a>.</p>

<p>The key take away: the 2nd argument will be used as the <code class="prettyprint">this</code> that is accessible in the function argument. If you followed along with that chunk of the spec, you may have seen <code class="prettyprint">[[Call]]</code> &#x2014; this is effectively saying that your JS is transformed into this:</p>
<div class="highlight"><pre><code class="language-js"><span class="nx">myFunction</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">thisArg</span><span class="p">,</span> <span class="nx">item</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">array</span><span class="p">);</span>
</code></pre></div>
<p>(I say &#x201C;effectively&#x201D; because that&#x2019;s not <em>exactly</em> how it happens but if you read the spec, the result is the same, with the same possible errors.)</p>

<h2>Putting it Together&#x2026;</h2>

<p>We know we want to call <code class="prettyprint">Function.prototype.call</code> and we know what function we want to be run. So the next thing to try is:</p>
<div class="highlight"><pre><code class="language-js"><span class="nx">callbacks</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">call</span><span class="p">);</span>
</code></pre></div>
<p>But that doesn&#x2019;t work. It&#x2019;s actually going to throw an error. Remember, <code class="prettyprint">this</code> is what gets called and we&#x2019;ve actually passed <code class="prettyprint">undefined</code> as this, not an item from our array. It really looks something like this:</p>
<div class="highlight"><pre><code class="language-js"><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">call</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</code></pre></div>
<p>We&#x2019;re almost there. We actually want to pass <code class="prettyprint">Function.prototype.call</code> as <code class="prettyprint">this</code> so it gets called &#x2014; effectively <code class="prettyprint">Function.prototype.call.call</code>. And that in turn is passed our callback. Basically, we&#x2019;re creating a little JavaScript <a href="http://en.wikipedia.org/wiki/Matryoshka_doll">Matryoshka doll</a>. It&#x2019;s a little crazy but it works.</p>
<div class="highlight"><pre><code class="language-js"><span class="nx">callbacks</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">call</span><span class="p">,</span> <span class="nb">Function</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">call</span><span class="p">);</span>
</code></pre></div>
<p>At the end of the day though, this isn&#x2019;t straightforward code. And in fact, <a href="http://jsperf.com/call-vs-prototype-call">it&#x2019;s quite slow</a>. So I can&#x2019;t recommend ever writing this code, though it made for an interesting thought experiment.</p>







        </div>
      </div><hr/><section id="articleList" style="font-size: 14px;"><b>Articles in This Issue</b><ul><li><a href="./The State of JavaScript in 2015.html">The State of JavaScript in 2015</a></li><li><a href="./io.js: A Node and npm-compatible JavaScript Platform.html">io.js: A Node and npm-compatible JavaScript Platform</a></li><li><a href="./The DailyJS JavaScript Developer Survey 2014.html">The DailyJS JavaScript Developer Survey 2014</a></li><li><a href="./SVG In-Depth Online-In-Person Workshop.html">SVG In-Depth Online/In-Person Workshop</a></li><li><a href="./<img src="http:--s3.amazonaws.com-nlga-uploads-item-image-30504-i.png" style="border: 0px solid #bbbbbb" width="120" height="120" alt="Frontend Masters">.html"><img src="http://s3.amazonaws.com/nlga/uploads/item/image/30504/i.png" style="border: 0px solid #bbbbbb" width="120" height="120" alt="Frontend Masters"></a></li><li><a href="./Getting Started with JavaScript for Automation on OS X Yosemite.html">Getting Started with JavaScript for Automation on OS X Yosemite</a></li><li><a href="./Preparing for The Future of AngularJS.html">Preparing for The Future of AngularJS</a></li><li><a href="./Relieving Backbone Pain with Flux and React (video).html">Relieving Backbone Pain with Flux and React (video)</a></li><li><a href="./JavaScript developers - spend 60 seconds applying to 50 NYC jobs at once.html">JavaScript developers - spend 60 seconds applying to 50 NYC jobs at once</a></li><li><a href="./underdog.io..html">underdog.io.</a></li><li><a href="./Javascript Devs in High Demand! (SF, LA, NYC, ORD, BOS, LON).html">Javascript Devs in High Demand! (SF, LA, NYC, ORD, BOS, LON)</a></li><li><a href="./JS Remote Conf: An Online JavaScript Conference in February 2015.html">JS Remote Conf: An Online JavaScript Conference in February 2015</a></li><li><a href="./An Update on the Node.js Advisory Board.html">An Update on the Node.js Advisory Board</a></li><li><a href="./Demystifying JavaScript Variable Scope and Hoisting.html">Demystifying JavaScript Variable Scope and Hoisting</a></li><li><a href="./JavaScript Modules the ES6 Way.html">JavaScript Modules the ES6 Way</a></li><li><a href="./Top 10 Mistakes Node.js Developers Make.html">Top 10 Mistakes Node.js Developers Make</a></li><li><a href="./Level Up in Backbone.js, A Powerful JavaScript MVC Framework.html">Level Up in Backbone.js, A Powerful JavaScript MVC Framework</a></li><li><a href="./Creating Nice Alerts with sweetAlert.html">Creating Nice Alerts with sweetAlert</a></li><li><a href="./Use ngStorage For All Your AngularJS Local Storage Needs.html">Use ngStorage For All Your AngularJS Local Storage Needs</a></li><li><a href="./Calling an Array of Functions in JavaScript.html">Calling an Array of Functions in JavaScript</a></li><li><a href="./The Anatomy of A Simple Templating Engine.html">The Anatomy of A Simple Templating Engine</a></li><li><a href="./The Case For Marionette.js (a Backbone framework).html">The Case For Marionette.js (a Backbone framework)</a></li><li><a href="./PhotoSwipe: A Photo Gallery, with No Dependencies.html">PhotoSwipe: A Photo Gallery, with No Dependencies</a></li><li><a href="./MagicEye.js: JS Lib (+ demo) for Generating 3D Magic Eye Images.html">MagicEye.js: JS Lib (+ demo) for Generating 3D Magic Eye Images</a></li><li><a href="./Preceptor: Test Runner and Aggregator.html">Preceptor: Test Runner and Aggregator</a></li><li><a href="./React Tween State: The Equivalent of React's this.setState, but for Animated Tweening.html">React Tween State: The Equivalent of React's this.setState, but for Animated Tweening</a></li><li><a href="./Duktape: An Embeddable JavaScript Engine (ES 5.1 Compliant) Written in C.html">Duktape: An Embeddable JavaScript Engine (ES 5.1 Compliant) Written in C</a></li><li><a href="./MetricsGraphics.js: A Lightweight Graphics Library Based On D3.html">MetricsGraphics.js: A Lightweight Graphics Library Based On D3</a></li><li><a href="./Tweene: JavaScript Animation Proxy (Wraps-Abstracts Other Libs).html">Tweene: JavaScript Animation Proxy (Wraps/Abstracts Other Libs)</a></li><li><a href="./MustBe: Authorization Plumbing For Node.js - Express Apps.html">MustBe: Authorization Plumbing For Node.js / Express Apps</a></li></ul></section></div>