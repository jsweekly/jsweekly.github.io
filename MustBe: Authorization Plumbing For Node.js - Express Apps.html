<!doctype html><div style="max-width: 700px;font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;padding: 50px;line-height: 1.25;background: #f9f9f9;"><meta charset="UTF8"/><title>MustBe: Authorization Plumbing For Node.js / Express Apps</title><h1>MustBe: Authorization Plumbing For Node.js / Express Apps</h1><p><a href="https://github.com/derickbailey/mustbe?">Original Article</a> &middot; <a href="#articleList">Articles in this issue</a> </p><div><article class="markdown-body entry-content">

<p><a href="https://github.com/derickbailey/mustbe/blob/master/assets/authorized-access-only.jpg" target="_blank"><img src="https://github.com/derickbailey/mustbe/raw/master/assets/authorized-access-only.jpg" alt=""></a></p>

<p>MustBe is not a complete authorization framework, with roles
and responsibilities and models and data access and everything
that you need. Rather, it is the underlying plumbing that you
need to secure your site. It allows you to fill in the 
necessary parts to manage data access, roles and users, and
gives you the activity based plumbing to secure it all. </p>

<h2>
<a id="user-content-authorization-not-authentication" class="anchor" href="https://github.com/derickbailey/mustbe#authorization-not-authentication"></a>Authorization, Not Authentication</h2>

<p>MustBe is an authorization system - the part of a security system
that decides whether or not you are allowed to do something. This
is the second of authentication and authorization, where authentication
simply determines who you are. </p>

<p>Specifically, MustBe is an activity based authorization system. It
allows you to verify that a user has permissions to perform any
given activity in your application.</p>

<h2>
<a id="user-content-what-is-activity-based-authorization" class="anchor" href="https://github.com/derickbailey/mustbe#what-is-activity-based-authorization"></a>What Is Activity Based Authorization?</h2>

<p>The gist of it is that you check whether or not a user
has permission to perform an activity. How they get permission
to do that activity is up to you. Maybe it's throug a role,
maybe it's through data they have been assigned to. But the
permission for the activity is what needs to be checked.</p>

<p>For more detail on this, check out 
<a href="http://lostechies.com/derickbailey/2011/05/24/dont-do-role-based-authorization-checks-do-activity-based-checks/">my 2011 article on using activity based authorization checks</a>. 
It will give you the core of what you need to know about
whey role-based authorization checks are a bad idea, and why
activity based permissions are the way to go. </p>

<h2>
<a id="user-content-documentation" class="anchor" href="https://github.com/derickbailey/mustbe#documentation"></a>Documentation</h2>

<p>Detailed documentation about the configuration and use of
MustBe can be found in the <a href="https://github.com/derickbailey/mustbe/blob/master/docs">documentation folder</a>.</p>



<h2>
<a id="user-content-getting-started" class="anchor" href="https://github.com/derickbailey/mustbe#getting-started"></a>Getting Started</h2>

<p>The first thing you need to do is install MustBe, and
save it to your package.json file.</p>

<p><code>npm install --save mustbe</code></p>

<h3>
<a id="user-content-configure-once-in-your-app" class="anchor" href="https://github.com/derickbailey/mustbe#configure-once-in-your-app"></a>Configure Once In Your App</h3>

<p>In your app.js (or whatever bootstraps your app), require
the MustBe module, and also bring in a mustbe-config module
which you will define in a moment. </p>

<p>Call the <code>.config</code> method
on the <code>mustBe</code> object, and pass in the function that is
exported from the config module.</p>

<div class="highlight highlight-js"><pre><span class="pl-c">// app.js</span>

<span class="pl-s">var</span> mustBe <span class="pl-k">=</span> <span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">"</span>mustbe<span class="pl-pds">"</span></span>);
<span class="pl-s">var</span> mustBeConfig <span class="pl-k">=</span> <span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">"</span>./mustbe-config<span class="pl-pds">"</span></span>);
mustBe.configure(mustBeConfig);</pre></div>

<h3>
<a id="user-content-create-the-configuration" class="anchor" href="https://github.com/derickbailey/mustbe#create-the-configuration"></a>Create The Configuration</h3>

<p>Now you can create a <code>mustbe-config.js</code> file for your application.
Having the config file separate from the <code>app.js</code> bootstrapper
file helps to keep things clean.</p>

<p>Open the <code>mustbe-config.js</code> file and build your configuration.
Provide configuration for your user identity, route helpers, 
activities and/or overrides.</p>

<p>Here is a basic configuration example from which you can start:</p>

<div class="highlight highlight-js"><pre><span class="pl-c">// ./mustbe-config.js</span>
<span class="pl-s">var</span> mustBe <span class="pl-k">=</span> <span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">"</span>mustbe<span class="pl-pds">"</span></span>);
<span class="pl-s3">module</span>.<span class="pl-en">exports</span> <span class="pl-k">=</span> <span class="pl-st">function</span>(<span class="pl-vpf">config</span>){

  config.routeHelpers(<span class="pl-st">function</span>(<span class="pl-vpf">rh</span>){
    <span class="pl-c">// get the current user from the request object</span>
    rh.getUser(<span class="pl-st">function</span>(<span class="pl-vpf">req</span>, <span class="pl-vpf">cb</span>){
      <span class="pl-c">// return cb(err); if there is an error</span>
      cb(<span class="pl-c1">null</span>, req.user);
    });

    <span class="pl-c">// what do we do when the user is not authorized?</span>
    rh.notAuthorized(<span class="pl-st">function</span>(<span class="pl-vpf">req</span>, <span class="pl-vpf">res</span>, <span class="pl-vpf">next</span>){
      res.redirect(<span class="pl-s1"><span class="pl-pds">"</span>/login?msg=you are not authorized<span class="pl-pds">"</span></span>);
    });
  });

  config.activities(<span class="pl-st">function</span>(<span class="pl-vpf">activities</span>){
    <span class="pl-c">// configure an activity with an authorization check</span>
    activities.can(<span class="pl-s1"><span class="pl-pds">"</span>view thing<span class="pl-pds">"</span></span>, <span class="pl-st">function</span>(<span class="pl-vpf">identity</span>, <span class="pl-vpf">params</span>, <span class="pl-vpf">cb</span>){
      <span class="pl-s">var</span> id <span class="pl-k">=</span> params[<span class="pl-s1"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>];
      someLib.anotherThing(id, <span class="pl-st">function</span>(<span class="pl-vpf">err</span>, <span class="pl-vpf">thing</span>){
        <span class="pl-k">if</span> (err) { <span class="pl-k">return</span> cb(err); }
        <span class="pl-s">var</span> hasThing <span class="pl-k">=</span> <span class="pl-k">!!</span>thing;
        cb(<span class="pl-c1">null</span>, hasThing);
      });
    });
  });

};</pre></div>

<p>Now you can run the <code>mustBe</code> functions on your routes.</p>

<div class="highlight highlight-js"><pre><span class="pl-s">var</span> mustbe <span class="pl-k">=</span> <span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">"</span>mustbe<span class="pl-pds">"</span></span>).routeHelpers();
<span class="pl-s">var</span> express <span class="pl-k">=</span> <span class="pl-s3">require</span>(<span class="pl-s1"><span class="pl-pds">"</span>express<span class="pl-pds">"</span></span>);

<span class="pl-s">var</span> router <span class="pl-k">=</span> express.Router();
router.get(<span class="pl-s1"><span class="pl-pds">"</span>/:id<span class="pl-pds">"</span></span>, mustBe.authorized(<span class="pl-s1"><span class="pl-pds">"</span>view thing<span class="pl-pds">"</span></span>, view));

<span class="pl-st">function</span> <span class="pl-en">view</span>(<span class="pl-vpf">req</span>, <span class="pl-vpf">res</span>, <span class="pl-vpf">next</span>){
  res.render(<span class="pl-s1"><span class="pl-pds">"</span>/something<span class="pl-pds">"</span></span>);
}</pre></div>

<p>Be sure to read the full documentation, linked above, for the
complete set of options and methods that can be called to
configure and use MustBe.</p>

<h2>
<a id="user-content-legal-junk" class="anchor" href="https://github.com/derickbailey/mustbe#legal-junk"></a>Legal Junk</h2>

<p>MustBe is Copyright 2014 Muted Solutions, LLC. All Rights Reserved.</p>

<p>Distributed under <a href="http://mutedsolutions.mit-license.org">MIT License</a>.</p>
</article>
  </div><hr/><section id="articleList" style="font-size: 14px;"><b>Articles in This Issue</b><ul><li><a href="./The State of JavaScript in 2015.html">The State of JavaScript in 2015</a></li><li><a href="./io.js: A Node and npm-compatible JavaScript Platform.html">io.js: A Node and npm-compatible JavaScript Platform</a></li><li><a href="./The DailyJS JavaScript Developer Survey 2014.html">The DailyJS JavaScript Developer Survey 2014</a></li><li><a href="./SVG In-Depth Online-In-Person Workshop.html">SVG In-Depth Online/In-Person Workshop</a></li><li><a href="./<img src="http:--s3.amazonaws.com-nlga-uploads-item-image-30504-i.png" style="border: 0px solid #bbbbbb" width="120" height="120" alt="Frontend Masters">.html"><img src="http://s3.amazonaws.com/nlga/uploads/item/image/30504/i.png" style="border: 0px solid #bbbbbb" width="120" height="120" alt="Frontend Masters"></a></li><li><a href="./Getting Started with JavaScript for Automation on OS X Yosemite.html">Getting Started with JavaScript for Automation on OS X Yosemite</a></li><li><a href="./Preparing for The Future of AngularJS.html">Preparing for The Future of AngularJS</a></li><li><a href="./Relieving Backbone Pain with Flux and React (video).html">Relieving Backbone Pain with Flux and React (video)</a></li><li><a href="./JavaScript developers - spend 60 seconds applying to 50 NYC jobs at once.html">JavaScript developers - spend 60 seconds applying to 50 NYC jobs at once</a></li><li><a href="./underdog.io..html">underdog.io.</a></li><li><a href="./Javascript Devs in High Demand! (SF, LA, NYC, ORD, BOS, LON).html">Javascript Devs in High Demand! (SF, LA, NYC, ORD, BOS, LON)</a></li><li><a href="./JS Remote Conf: An Online JavaScript Conference in February 2015.html">JS Remote Conf: An Online JavaScript Conference in February 2015</a></li><li><a href="./An Update on the Node.js Advisory Board.html">An Update on the Node.js Advisory Board</a></li><li><a href="./Demystifying JavaScript Variable Scope and Hoisting.html">Demystifying JavaScript Variable Scope and Hoisting</a></li><li><a href="./JavaScript Modules the ES6 Way.html">JavaScript Modules the ES6 Way</a></li><li><a href="./Top 10 Mistakes Node.js Developers Make.html">Top 10 Mistakes Node.js Developers Make</a></li><li><a href="./Level Up in Backbone.js, A Powerful JavaScript MVC Framework.html">Level Up in Backbone.js, A Powerful JavaScript MVC Framework</a></li><li><a href="./Creating Nice Alerts with sweetAlert.html">Creating Nice Alerts with sweetAlert</a></li><li><a href="./Use ngStorage For All Your AngularJS Local Storage Needs.html">Use ngStorage For All Your AngularJS Local Storage Needs</a></li><li><a href="./Calling an Array of Functions in JavaScript.html">Calling an Array of Functions in JavaScript</a></li><li><a href="./The Anatomy of A Simple Templating Engine.html">The Anatomy of A Simple Templating Engine</a></li><li><a href="./The Case For Marionette.js (a Backbone framework).html">The Case For Marionette.js (a Backbone framework)</a></li><li><a href="./PhotoSwipe: A Photo Gallery, with No Dependencies.html">PhotoSwipe: A Photo Gallery, with No Dependencies</a></li><li><a href="./MagicEye.js: JS Lib (+ demo) for Generating 3D Magic Eye Images.html">MagicEye.js: JS Lib (+ demo) for Generating 3D Magic Eye Images</a></li><li><a href="./Preceptor: Test Runner and Aggregator.html">Preceptor: Test Runner and Aggregator</a></li><li><a href="./React Tween State: The Equivalent of React's this.setState, but for Animated Tweening.html">React Tween State: The Equivalent of React's this.setState, but for Animated Tweening</a></li><li><a href="./Duktape: An Embeddable JavaScript Engine (ES 5.1 Compliant) Written in C.html">Duktape: An Embeddable JavaScript Engine (ES 5.1 Compliant) Written in C</a></li><li><a href="./MetricsGraphics.js: A Lightweight Graphics Library Based On D3.html">MetricsGraphics.js: A Lightweight Graphics Library Based On D3</a></li><li><a href="./Tweene: JavaScript Animation Proxy (Wraps-Abstracts Other Libs).html">Tweene: JavaScript Animation Proxy (Wraps/Abstracts Other Libs)</a></li><li><a href="./MustBe: Authorization Plumbing For Node.js - Express Apps.html">MustBe: Authorization Plumbing For Node.js / Express Apps</a></li></ul></section></div>