<!doctype html><div style="max-width: 700px;font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif;padding: 50px;line-height: 1.25;background: #f9f9f9;"><meta charset="UTF8"/><title>What Is The Flux Application Architecture?</title><h1>What Is The Flux Application Architecture?</h1><p><a href="https://medium.com/brigade-engineering/what-is-the-flux-application-architecture-b57ebca85b9e?">Original Article</a> &middot; <a href="#articleList">Articles in this issue</a> </p><div><div class="section-inner layoutSingleColumn"><p name="2710" class="graf--p graf--first"><a id="2710"></a>Flux is an idea for organizing your application that was developed at Facebook, based on one simple principle:</p><blockquote name="70d9" class="graf--pullquote pullquote"><a id="70d9"></a>Data moves in one direction through your application.</blockquote><p name="0368" class="graf--p"><a id="0368"></a>This is called <strong class="markup--strong markup--p-strong">&#x201C;unidirectional data flow&#x201D;</strong>, but it might be easier to to remember if you think of your data as a shark: <a target="_blank" href="http://animalquestions.org/fish/sharks/can-sharks-swim-backwards/" class="markup--anchor markup--p-anchor" rel="nofollow">Sharks can only swim forward</a>.</p><p name="9269" class="graf--p"><a id="9269"></a>Facebook has published <a target="_blank" href="https://github.com/facebook/flux/tree/master/examples" class="markup--anchor markup--p-anchor" rel="nofollow">examples of Flux</a>, and <a target="_blank" href="https://reactjsnews.com/the-state-of-flux/" class="markup--anchor markup--p-anchor" rel="nofollow">at least six other libraries have sprung up</a> with interpretations. For the purpose of this article, when we say &#x201C;Flux&#x201D;, we are referring to the Facebook implementation.</p><p name="ae7c" class="graf--p"><a id="ae7c"></a>To understand Flux, let&#x2019;s walk through a basic Todo application. You can <a target="_blank" href="https://github.com/facebook/flux/tree/master/examples/flux-todomvc" class="markup--anchor markup--p-anchor" rel="nofollow">find the full source code in the Facebook Flux Repository</a>.</p><figure name="72c3" class="graf--figure"><a id="72c3"></a><div class="aspectRatioPlaceholder is-locked"><img class="graf-image" src="https://d262ilb51hltx0.cloudfront.net/max/800/1*nA1DG1kJFvIyBnFyb50Efg.jpeg"></div></figure><p name="9868" class="graf--p"><a id="9868"></a>When the application starts, the <em class="markup--em markup--p-em">ToDoApp</em> React component fetches and displays the data that is present in the <em class="markup--em markup--p-em">ToDoStore</em>. The <em class="markup--em markup--p-em">ToDoStore</em> is completely unaware of the <em class="markup--em markup--p-em">ToDoApp</em> component. If you imagine the component acting as a View, and the <em class="markup--em markup--p-em">ToDoStore</em> as a Model, then so far this isn&#x2019;t so different from MVC.</p><figure name="523d" class="graf--figure graf--iframe"><a id="523d"></a></figure><p name="ca29" class="graf--p"><a id="ca29"></a>In this simplified example, we aren&#x2019;t worrying about how the <em class="markup--em markup--p-em">ToDoStore</em> loads the initial data.</p><figure name="07e6" class="graf--figure"><a id="07e6"></a><div class="aspectRatioPlaceholder is-locked"><img class="graf-image" src="https://d262ilb51hltx0.cloudfront.net/max/800/1*5L_Lj-TKzsDoFHio8JMFGw.jpeg"></div></figure><p name="eb5f" class="graf--p"><a id="eb5f"></a>The <em class="markup--em markup--p-em">ToDoApp</em> Component has a form for creating a new ToDo item. When a user submits that form, it kicks off a flow of data through the Flux system, as illustrated above:</p><ol class="postList"><li name="fc57" class="graf--li"><a id="fc57"></a><strong class="markup--strong markup--li-strong">The component handles the form submission by calling its own callback.</strong></li></ol><figure name="309e" class="graf--figure graf--iframe"><a id="309e"></a></figure><p name="9d7e" class="graf--p"><a id="9d7e"></a><strong class="markup--strong markup--p-strong">2. The component callback calls a method on the <em class="markup--em markup--p-em">ToDoActionCreator</em>.</strong></p><figure name="5616" class="graf--figure graf--iframe"><a id="5616"></a></figure><p name="46f8" class="graf--p"><a id="46f8"></a><strong class="markup--strong markup--p-strong">3. The <em class="markup--em markup--p-em">ToDoActionCreator</em> creates an action of the type <em class="markup--em markup--p-em">TODO_CREATE</em>.</strong></p><figure name="7753" class="graf--figure graf--iframe"><a id="7753"></a></figure><p name="f253" class="graf--p"><a id="f253"></a><strong class="markup--strong markup--p-strong">4. The action is sent to the <em class="markup--em markup--p-em">Dispatcher</em>.</strong></p><p name="3335" class="graf--p"><a id="3335"></a><strong class="markup--strong markup--p-strong">5. The <em class="markup--em markup--p-em">Dispatcher</em> passes the action to all registered callbacks from <em class="markup--em markup--p-em">Stores</em>.</strong></p><figure name="d20b" class="graf--figure graf--iframe"><a id="d20b"></a></figure><p name="319d" class="graf--p"><a id="319d"></a><strong class="markup--strong markup--p-strong">6. The <em class="markup--em markup--p-em">ToDoStore</em> has a registered callback that listens for the <em class="markup--em markup--p-em">TODO_CREATE</em> action, and updates its own data.</strong></p><figure name="2bac" class="graf--figure graf--iframe"><a id="2bac"></a></figure><p name="9b0d" class="graf--p"><a id="9b0d"></a><strong class="markup--strong markup--p-strong">7. The <em class="markup--em markup--p-em">ToDoStore</em> fires a <em class="markup--em markup--p-em">change event</em> after updating it&#x2019;s data.</strong></p><figure name="ca14" class="graf--figure graf--iframe"><a id="ca14"></a></figure><p name="b023" class="graf--p"><a id="b023"></a><strong class="markup--strong markup--p-strong">8. The ToDoApp component is listening for <em class="markup--em markup--p-em">change events</em> from the <em class="markup--em markup--p-em">ToDoStore</em>, and re-renders the UI based on the latest data from the <em class="markup--em markup--p-em">ToDoStore</em>.</strong></p><figure name="e4f2" class="graf--figure graf--iframe"><a id="e4f2"></a></figure><p name="002c" class="graf--p"><a id="002c"></a>Flux has been <a target="_blank" href="https://www.youtube.com/watch?v=nYkdrAPrdcw&amp;list=PLb0IAmt7-GS188xDYE-u1ShQmFFGbrk0v#t=1215" class="markup--anchor markup--p-anchor" rel="nofollow">presented as an alternative to MVC</a>. <a target="_blank" href="https://github.com/facebook/flux#how-flux-works" class="markup--anchor markup--p-anchor" rel="nofollow">The documentation for Flux</a> explains that it &#x201C;eschews MVC in favor of a unidirectional data flow&#x201D;. When comparing Flux to MVC, you have to understand three things:</p><ol class="postList"><li name="806c" class="graf--li graf--startsWithDoubleQuote"><a id="806c"></a>&#x201C;MVC&#x201D; actually means &#x201C;MV*&#x201D; in the land of JavaScript.</li><li name="45fe" class="graf--li"><a id="45fe"></a>Flux is not simpler than MV*.</li><li name="3e7b" class="graf--li"><a id="3e7b"></a>Flux keeps things more predictable than MV*.</li></ol><blockquote name="2c95" class="graf--pullquote pullquote graf--startsWithDoubleQuote"><a id="2c95"></a>&#x201C;MVC&#x201D; actually means &#x201C;MV*&#x201D; in the land of JavaScript.</blockquote><p name="b85e" class="graf--p"><a id="b85e"></a>In order to compare Flux to MVC, we need to understand what MVC means in this context.</p><p name="4397" class="graf--p"><a id="4397"></a>There are 15 examples of JavaScript frameworks on <a target="_blank" href="http://todomvc.com/" class="markup--anchor markup--p-anchor" rel="nofollow">ToDoMVC</a>, but none are strict implementations of the &#x201C;Model, View, Controller&#x201D; design pattern. Take <a target="_blank" href="http://backbonejs.org/" class="markup--anchor markup--p-anchor" rel="nofollow">Backbone.js</a> as an example: It has models and views, but there is arguably no controller in Backbone.js. The role of the controller in many JavaScript frameworks is absorbed into the view or model, and there may be other important categories of functionality, such as a router.</p><p name="8125" class="graf--p"><a id="8125"></a>When we use &#x201C;MVC&#x201D; or &#x201C;MV*&#x201D; to describe a JavaScript architecture, we generally mean that it has a separation of concerns when dealing with business logic and user interfaces. The data storage is compartmentalized into &#x201C;models&#x201D;, while the presentation and user interactions are dealt with in &#x201C;views&#x201D;.</p><p name="fb44" class="graf--p"><a id="fb44"></a>This might work as follows: the view gets information from the model and displays it to the user. The user then interacts with it. These interactions trigger the view to update the data stored in the model, which then may trigger a UI update in the view.</p><figure name="1c17" class="graf--figure"><a id="1c17"></a><div class="aspectRatioPlaceholder is-locked"><img class="graf-image" src="https://d262ilb51hltx0.cloudfront.net/max/800/1*wqtf5sWAzQs0HTCVOhjnqA.jpeg"></div><figcaption class="imageCaption">Basic MVC Data Flow</figcaption></figure><blockquote name="859b" class="graf--pullquote pullquote"><a id="859b"></a>Flux is not simpler than MV*.</blockquote><p name="9ea3" class="graf--p"><a id="9ea3"></a>You may have watched the <a target="_blank" href="https://www.youtube.com/watch?v=nYkdrAPrdcw&amp;list=PLb0IAmt7-GS188xDYE-u1ShQmFFGbrk0v#t=627" class="markup--anchor markup--p-anchor" rel="nofollow">Facebook intro to Flux</a> and seen the analysis of why &#x201C;MVC doesn&#x2019;t scale&#x201D;, including a diagram showing the flow of data amongst 7 different models and views:</p><figure name="f2e5" class="graf--figure"><a id="f2e5"></a><div class="aspectRatioPlaceholder is-locked"><img class="graf-image" src="https://d262ilb51hltx0.cloudfront.net/max/800/1*gSSDaoZsDB-dZGKqnVk1gQ.jpeg"></div><figcaption class="imageCaption">Complex MVC Data Flow</figcaption></figure><p name="714e" class="graf--p"><a id="714e"></a>This makes MVC look super confusing&#x200A;&#x2014;&#x200A;look at all those arrows! Who can follow what&#x2019;s going on in that diagram? It seems obvious that Flux is simpler, right?</p><p name="b473" class="graf--p"><a id="b473"></a>But in that video we never get to see the same level of complexity implemented in Flux. Sure, it all &#x201C;collapses down&#x201D; to a simple flow of data:</p><figure name="4cca" class="graf--figure"><a id="4cca"></a><div class="aspectRatioPlaceholder is-locked"><img class="graf-image" src="https://d262ilb51hltx0.cloudfront.net/max/800/1*ZvLUQRHVsW1eWBN9sJQJDg.jpeg"></div><figcaption class="imageCaption">Basic Flux Data Flow</figcaption></figure><p name="1dda" class="graf--p"><a id="1dda"></a>Still, it is worth seeing what a large system implemented in Flux would look like. Here it is, and you&#x2019;ll notice that there are more arrows and boxes than the MVC version, not fewer:</p><figure name="3a55" class="graf--figure"><a id="3a55"></a><div class="aspectRatioPlaceholder is-locked"><img class="graf-image" src="https://d262ilb51hltx0.cloudfront.net/max/800/1*ICpUjYrHJa9TdIDwEIhooQ.jpeg"></div><figcaption class="imageCaption">Complex Flux Data Flow</figcaption></figure><p name="cc39" class="graf--p"><a id="cc39"></a>Flux has just as many moving parts as MV*. That is why this diagram looks just as complex as the MV* diagram&#x200A;&#x2014;&#x200A;but with one key difference: The arrows point in one direction, forming a consistent cycle through the system.</p><blockquote name="7603" class="graf--pullquote pullquote"><a id="7603"></a>Flux keeps things predictable.</blockquote><p name="8169" class="graf--p"><a id="8169"></a>There are many things going on in both the Flux and the MV* diagrams&#x200A;&#x2014;&#x200A;but the level of predictability in the Flux diagram is much higher.</p><p name="be7f" class="graf--p"><a id="be7f"></a>The dispatcher in Flux also ensures that the actions flow through the system one at at time. If an action is sent to the dispatcher before it is finished processing an existing action, it will throw an error:</p><blockquote name="9732" class="graf--blockquote graf--startsWithDoubleQuote"><a id="9732"></a>&#x201C;Uncaught Error: Invariant Violation: Dispatch.dispatch(&#x2026;): Cannot dispatch in the middle of a dispatch.&#x201D;</blockquote><p name="5d0f" class="graf--p"><a id="5d0f"></a>This is another way of keeping things predictable. It pushes developers to build applications without complicated interactions between data resources.</p><p name="50a1" class="graf--p"><a id="50a1"></a>The dispatcher also allows the developer to specify the order that stores execute their callbacks, using the <em class="markup--em markup--p-em">waitFor </em>method to tell one store to wait for another before executing its callback. If you write code where two stores <em class="markup--em markup--p-em">waitFor</em> each other, then <a target="_blank" href="http://facebook.github.io/react/blog/2014/07/30/flux-actions-and-the-dispatcher.html#why-we-need-a-dispatcher" class="markup--anchor markup--p-anchor" rel="nofollow">the dispatcher throws an informative error</a>.</p><p name="93e7" class="graf--p"><a id="93e7"></a>In the Facebook implementation of Flux you can see exactly what causes data to change. Every store includes a list of actions it listens to.</p><figure name="0a65" class="graf--figure graf--iframe"><a id="0a65"></a></figure><p name="fee1" class="graf--p"><a id="fee1"></a>In this example, the <em class="markup--em markup--p-em">ThreadStore</em> listens to the <em class="markup--em markup--p-em">CLICK_THREAD</em> action and the <em class="markup--em markup--p-em">RECEIVE_RAW_MESSAGES</em> action. If the store is not updating as expected, the <em class="markup--em markup--p-em">register</em> callback gives us a place to start debugging. We can log any actions it receives and inspect their payload of data.</p><p name="adf1" class="graf--p"><a id="adf1"></a>Similarly, every component maintains a list of which stores it listens to.</p><figure name="3fba" class="graf--figure graf--iframe"><a id="3fba"></a></figure><p name="66c6" class="graf--p"><a id="66c6"></a>Above, we see the <em class="markup--em markup--p-em">ThreadSection</em> component listens for changes in the <em class="markup--em markup--p-em">ThreadStore</em> and the <em class="markup--em markup--p-em">UnreadThreadStore</em>. If we consistently use this method for setting up listeners in the components for changes in the stores, then we can be sure that no other stores will affect the behavior of this component.</p><p name="f565" class="graf--p"><a id="f565"></a>Flux separates the concerns of receiving and sending data, so that when debugging you can easily follow the flow of data to see where things may be going wrong.</p><p name="d3c2" class="graf--p"><a id="d3c2"></a>Every choice in software engineering is a trade-off, and Flux is no exception. We have perceived the following disadvantages:</p><ul class="postList"><li name="28c8" class="graf--li"><a id="28c8"></a>It involves writing more boilerplate code</li><li name="a6c9" class="graf--li"><a id="a6c9"></a>Migrating existing resources can be a big task</li><li name="0309" class="graf--li"><a id="0309"></a>Unit testing can be difficult without good structure</li></ul><p name="4ddf" class="graf--p"><a id="4ddf"></a>Flux does add more files and more lines of code than one might feel are needed to handle the flow of data in an application. This will be more painful when writing fresh code for a new data resource, rather than adding code for a resource that already uses Flux. In the future we may have generators to make the set-up of Flux faster. <a href="https://medium.com/brigade-engineering/sharpen-your-vim-with-snippets-767b693886db" class="markup--anchor markup--p-anchor">Using Vim snippets can also speed things up.</a></p><p name="efa4" class="graf--p"><a id="efa4"></a>The easiest way to try Flux is with a new project. With anything new, getting others on board can be a challenge. This post, along with the <a target="_blank" href="http://facebook.github.io/flux/docs/overview.html" class="markup--anchor markup--p-anchor" rel="nofollow">documentation</a> and <a target="_blank" href="https://github.com/facebook/flux/tree/master/examples" class="markup--anchor markup--p-anchor" rel="nofollow">examples</a> from Facebook, will give you the knowledge needed for educating others. You can be confident that if Facebook and many other companies are using Flux for production code, in projects large and small, then it will scale for your project too.</p><p name="a465" class="graf--p"><a id="a465"></a>When migrating an existing application to Flux, you can try out the Flux architecture with one data resource at a time. However, when considering using Flux to manage a piece of data in your application, think about how many components use that piece of data. If it is used in most of your components, then it could be a big job to move the management of that particular piece of data to Flux. Start with a more isolated piece of data when first trying Flux out.</p><p name="c022" class="graf--p"><a id="c022"></a>With Flux your components start depending on <em class="markup--em markup--p-em">ActionCreators</em> and <em class="markup--em markup--p-em">Stores</em> as well as their usual dependencies on each other. This can make it more difficult to write unit tests. If you restrict the interaction with <em class="markup--em markup--p-em">Stores</em> to the top level &#x201C;controller&#x201D; components in your application, then you can unit test the child components without worrying about the <em class="markup--em markup--p-em">Stores</em>. For testing components that do need to send <em class="markup--em markup--p-em">Actions</em> and listen to <em class="markup--em markup--p-em">Stores</em>, we have had some success with mocking the <em class="markup--em markup--p-em">Store</em> methods, or mocking the API responses that the <em class="markup--em markup--p-em">Actions</em> and <em class="markup--em markup--p-em">Stores</em> use to get data.</p><p name="a1cb" class="graf--p"><a id="a1cb"></a>At <a target="_blank" href="http://brigade.com/" class="markup--anchor markup--p-anchor" rel="nofollow">Brigade</a>, we have learned from the experience of moving to a Flux approach. Have you tried Flux? Have you run into any difficulties, and how have you solved them? I look forward to seeing more examples and discussion of Flux in the future.</p><p name="f1c7" class="graf--p graf--last"><a id="f1c7"></a>If you haven&#x2019;t worked with Flux, then I hope this post gave you some insight into this approach to organizing an application.</p></div></div><hr/><section id="articleList" style="font-size: 14px;"><b>Articles in This Issue</b><ul><li><a href="./Meta Programming with ECMAScript 6 Proxies.html">Meta Programming with ECMAScript 6 Proxies</a></li><li><a href="./AngularJS Performance in Large Applications.html">AngularJS Performance in Large Applications</a></li><li><a href="./What Is The Flux Application Architecture?.html">What Is The Flux Application Architecture?</a></li><li><a href="./An easier way to deploy &amp; host your Rails app – for free..html">An easier way to deploy &amp; host your Rails app – for free.</a></li><li><a href="./<img src="http:--s3.amazonaws.com-nlga-uploads-item-image-24793-i.png" style="border: 0px solid #bbbbbb" width="" height="" alt="Ninefold">.html"><img src="http://s3.amazonaws.com/nlga/uploads/item/image/24793/i.png" style="border: 0px solid #bbbbbb" width="" height="" alt="Ninefold"></a></li><li><a href="./16 Steps for Planning A Front-End JavaScript Application.html">16 Steps for Planning A Front-End JavaScript Application</a></li><li><a href="./Node.js Is Forked, Not F***ed.html">Node.js Is Forked, Not F***ed</a></li><li><a href="./Programmer Extraordinaire..html">Programmer Extraordinaire.</a></li><li><a href="./JavaScript Developers, AngularJS-Node.js (Berlin).html">JavaScript Developers, AngularJS/Node.js (Berlin)</a></li><li><a href="./President Obama Writes His First Line of JavaScript.html">President Obama Writes His First Line of JavaScript</a></li><li><a href="./ES6 Template Strings Working in Chrome.html">ES6 Template Strings Working in Chrome</a></li><li><a href="./Ember.js 1.9.0 and 1.10 Beta Released.html">Ember.js 1.9.0 and 1.10 Beta Released</a></li><li><a href="./'JavaScript for Kids' Book Released.html">'JavaScript for Kids' Book Released</a></li><li><a href="./Making A Complete Polyfill For The HTML5 'details' Element.html">Making A Complete Polyfill For The HTML5 'details' Element</a></li><li><a href="./Techniques for Building Web Apps using Future Friendly ES6 Module Syntax.html">Techniques for Building Web Apps using Future Friendly ES6 Module Syntax</a></li><li><a href="./Effective Event Binding with jQuery.html">Effective Event Binding with jQuery</a></li><li><a href="./Five Traits of Well-Organized JavaScript.html">Five Traits of Well-Organized JavaScript</a></li><li><a href="./Porting An Entire Desktop Toolchain to The Browser with Emscripten.html">Porting An Entire Desktop Toolchain to The Browser with Emscripten</a></li><li><a href="./The State of Desktop Applications in Node.js.html">The State of Desktop Applications in Node.js</a></li><li><a href="./thaw.js: Synthetic Asynchronous Processing.html">thaw.js: Synthetic Asynchronous Processing</a></li><li><a href="./FiltrES.js: A Simple, Safe, ElasticSearch Query Compiler.html">FiltrES.js: A Simple, Safe, ElasticSearch Query Compiler</a></li><li><a href="./Angular 2.0 Hello World Example.html">Angular 2.0 Hello World Example</a></li><li><a href="./Purplecoat.js: Simple Labeled Overlays (jQuery Plugin).html">Purplecoat.js: Simple Labeled Overlays (jQuery Plugin)</a></li><li><a href="./dstore: A Client-Side Data Management Framework with Multiple Store Types.html">dstore: A Client-Side Data Management Framework with Multiple Store Types</a></li><li><a href="./bigpicture.js: A Library for Prezi-esque Infinite Panning and Infinite Zooming.html">bigpicture.js: A Library for Prezi-esque Infinite Panning and Infinite Zooming</a></li><li><a href="./decimal.js: An Arbitrary-Precision Decimal Type for JavaScript.html">decimal.js: An Arbitrary-Precision Decimal Type for JavaScript</a></li></ul></section></div>